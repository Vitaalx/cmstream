<div class="w-full flex gap-[20px] add-comment">
    <div class="avatar">
        <user-image cv-if="this.isConnected" size="48"/>
        <icon cv-if="!this.isConnected" name="account-circle" class="block mt-[-15px] text-[48px]"/>
    </div>
    <cv-form 
    class="flex-1 flex flex-col items-end comment"
    @submit="submit" 
    >
        <text-input
        type="text"
        placeholder="Ajouter un commentaire..."
        cv-model="content"
        :rules="this.commentRule"
        class="w-full"
        />

        <button 
        type="submit" 
        class="mt-[30px] px-[20px] py-[10px] rounded bg-darkblue submit"
        >
        Commenter
        </button> 
    </cv-form>
</div>

<script>
    const [impLoader, impTaob, user_image] = await Promise.all([
        import("/public/cuteVue/loader.js"),
        import("/public/cuteVue/taob.js"),
        importer('/public/cuteVue/components/account/user-image.html'),
    ]);

    const loaderStore = impLoader.loaderStore;
    const taob = impTaob.default;

    export default {
        components: {
            "user-image": user_image
        },
        data: {
            content: "",
            success: false
        },
        static: {
            commentRule: [
                (value) => !!value || "Ce champs est obligatoire",
            ]
        },
        methods: {
            async submit(){
                let close = loaderStore.push();

                this.success = false;

                const comment = {
                    content: this.content, // TODO: change video_id and user_id
                    video_id: 1,
                    user_id: this.userId,
                    status: 1,
                }

                await taob.post("/comment", comment)
                .s(() => {
                    this.success = true;
                    comment.user = {
                        username: this.username
                    }
                    this.$emit("add-comment", comment);
                    this.content = "";
                })
                .e(() => {
                    alert("Une erreur est survenue lors de l'ajout du commentaire");
                })
                .result;

                close();
            }
        },
        stores: [
            {
                name: "user",
                states: ["isConnected", "userId", "username"],
            }
        ]
    }
</script>

<style>
    
</style>